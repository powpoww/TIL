### 1. Groupby

**DataFrame.groupby(by=None, axis=0, level=None, as_index=True, sort=True, group_keys=True, squeeze=NoDefault.no_default, observed=False, dropna=True)**

- 그룹할 컬럼을 `axis`로 연산 방향을 설정해 원하는 결과를 출력할 수 있다. 멀티인덱스인 경우 `level`로 특정 레벨을 그룹할 컬럼으로 설정 가능하다.

```python
>>> kimchi = pd.read_csv('./data/kimchi_test.csv', encoding='cp949')
     판매년도  판매월    제품   판매처     수량       판매금액
0    2013    1  총각김치  대형마트  27916  233968900
1    2013    1  총각김치   백화점  11971   99796735
2    2013    1  총각김치   편의점   1603    2264200
3    2013    2  총각김치  대형마트  23057  194593960
4    2013    2  총각김치   백화점  11678  103106940
..    ...  ...   ...   ...    ...        ...
427  2016   11   무김치   백화점  16818  213580462
428  2016   11   무김치   편의점   1849    2718207
429  2016   12   무김치  대형마트  40806  351917006
430  2016   12   무김치   백화점  11877  139476205
431  2016   12   무김치   편의점   1890    2767080
​
# 예제) 제품별, 판매처 별(김치별) 수량 총 합
>>> kimchi.groupby(by=['제품', '판매처']).sum()
            판매년도  판매월       수량         판매금액
제품   판매처                                   
무김치  대형마트  96696  312  1550027  14243851204
     백화점   96696  312   510114   5675796839
     편의점   96696  312    82623    117134302
열무김치 대형마트  96696  312  1491864  14272706507
     백화점   96696  312   567129   5897836502
     편의점   96696  312    89006    125133810
총각김치 대형마트  96696  312  1649486  16512153282
     백화점   96696  312   658442   6639524485
     편의점   96696  312   103725    149010519
​
# groupby 결과 내 컬럼을 선택해 메서드를 적용할 수 있다.
>>> kimchi.groupby(by='제품')[['수량', '판매금액']].sum()
           수량         판매금액
제품                        
무김치   2142764  20036782345
열무김치  2147999  20295676819
총각김치  2411653  23300688286
​
# groupby 결과에 두가지 메서드를 적용 가능.
# 예제) 제품별, 판매처별 수량과 판매급액의 총합, 평균
>>>  kimchi.groupby(['제품', '판매처'])[['수량', '판매금액']].agg(['sum', 'mean'])
                수량                       판매금액              
               sum          mean          sum          mean
제품   판매처                                                   
무김치  대형마트  1550027  32292.229167  14243851204  2.967469e+08
     백화점    510114  10627.375000   5675796839  1.182458e+08
     편의점     82623   1721.312500    117134302  2.440298e+06
열무김치 대형마트  1491864  31080.500000  14272706507  2.973481e+08
     백화점    567129  11815.187500   5897836502  1.228716e+08
     편의점     89006   1854.291667    125133810  2.606954e+06
총각김치 대형마트  1649486  34364.291667  16512153282  3.440032e+08
     백화점    658442  13717.541667   6639524485  1.383234e+08
     편의점    103725   2160.937500    149010519  3.104386e+06
​
# groupby 결과에 각 컬럼에 다른 메서드를 적용 가능.
# 예제> 제품별, 판매처별 수량은 총합을 하고 판매금액은 평균값을 계산하시오.
>>> kimchi.groupby(['제품', '판매처'])[['수량', '판매금액']].agg({'수량': 'sum', '판매금액': 'mean'})
                수량          판매금액
제품   판매처                        
무김치  대형마트  1550027  2.967469e+08
     백화점    510114  1.182458e+08
     편의점     82623  2.440298e+06
열무김치 대형마트  1491864  2.973481e+08
     백화점    567129  1.228716e+08
     편의점     89006  2.606954e+06
총각김치 대형마트  1649486  3.440032e+08
     백화점    658442  1.383234e+08
     편의점    103725  3.104386e+06
​
# 레벨 기준의 groupby 수행
>>> kimchi_2
제품    판매처 
무김치   대형마트    1550027
      백화점      510114
      편의점       82623
열무김치  대형마트    1491864
      백화점      567129
      편의점       89006
총각김치  대형마트    1649486
      백화점      658442
      편의점      103725
Name: 수량, dtype: int64
>>> kimchi_2.groupby(level=0).sum()  # 제품별 총합
제품
무김치     2142764
열무김치    2147999
총각김치    2411653
Name: 수량, dtype: int64
```



### 2. Multiindex, Stack, Unstack

**DataFrame.stack(level=- 1, dropna=True)**

**DataFrame.unstack(level=- 1, fill_value=None)**

- 멀티 인덱스는 인덱스나 컬럼의 레벨이 여러개로 나뉘어 있는것을 말한다. 최상위 레벨(가장 바깥 인덱스)를 0으로 하위레벨로 갈수록 수가 증가한다.

```python
# 멀티 인덱스
# 인덱스나 컬럼이 여러 레벨로 구분되는 것.
# 상위레벨 : 0, 하위레벨로 갈수록 숫자 증가.
​
kimchi = pd.read_csv('./data/kimchi_test.csv', encoding='cp949')   
​
# kimchi 데이터를 연도별, 제품별로 수량의 총합을 구함
df1 = kimchi.groupby(['판매년도', '제품'])['수량'].sum()
df1
판매년도  제품  
2013  무김치     420750
      열무김치    419045
      총각김치    483735
2014  무김치     447768
      열무김치    489359
      총각김치    551613
2015  무김치     540809
      열무김치    601661
      총각김치    742150
2016  무김치     733437
      열무김치    637934
      총각김치    634155
Name: 수량, dtype: int64
# unstack level 1 index
>>> df2 = df1.unstack()    # long -> wide
제품       무김치    열무김치    총각김치
판매년도                        
2013  420750  419045  483735
2014  447768  489359  551613
2015  540809  601661  742150
2016  733437  637934  634155
# unstack level 0 index
>>> df1.unstack(level=0)
판매년도    2013    2014    2015    2016
제품                                  
무김치   420750  447768  540809  733437
열무김치  419045  489359  601661  637934
총각김치  483735  551613  742150  634155
# stack level 0, 1 index
​
# stack level 0 column
>>> df2.stack()             
판매년도  제품  
2013  무김치     420750
      열무김치    419045
      총각김치    483735
2014  무김치     447768
      열무김치    489359
      총각김치    551613
2015  무김치     540809
      열무김치    601661
      총각김치    742150
2016  무김치     733437
      열무김치    637934
      총각김치    634155
        
# n개의 컬럼을 stack 할 수 있다.
>>> multicol2 = pd.MultiIndex.from_tuples([('weight', 'kg'),
                                           ('height', 'm')])
>>> df_multi_level_cols2 = pd.DataFrame([[1.0, 2.0], [3.0, 4.0]],
                                        index=['cat', 'dog'],
                                        columns=multicol2)
>>> df_multi_level_cols2.stack([0, 1])
cat  height  m     2.0
     weight  kg    1.0
dog  height  m     4.0
     weight  kg    3.0
dtype: float64
```



### 3. Pivot Table

```python
>>> kimchi.pivot_table(index = '판매월',    # index에 배치할 컬럼
                      columns = '판매처',   # column에 배치할 컬럼
                      values = '수량',     # 교차표에 작성할 값을 찾는 컬럼
                      aggfunc = 'sum')     # 그룹 함수
​
# 예제) kimchi를 이용해서 연도별 제품별 판매금액의 총합을 교차표로 작성.
>>> kimchi.pivot_table(index='판매년도', columns='제품', values='판매금액', aggfunc='sum' )
제품           무김치        열무김치        총각김치
판매년도                                    
2013  3809133886  3416217894  4186789117
2014  4111403907  4392490590  5250364301
2015  5212738410  5859079408  7485159996
2016  6903506142  6627888927  6378374872
```
